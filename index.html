<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ú†Øªâ€ŒØ±ÙˆÙ… Ø¬Ù‡Ø§Ù†ÛŒ Ù…Ø¯Ø±Ù†</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;500;800&display=swap');

        * {
            box-sizing: border-box;
            font-family: 'Vazirmatn', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: #111119;
            color: white;
            overflow: hidden; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ Ú©Ù„ ØµÙØ­Ù‡ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ ØªÙ…Ø§Ù…â€ŒØµÙØ­Ù‡ */
        .overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 15, 25, 0.95);
            backdrop-filter: blur(15px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            width: 85%;
            max-width: 350px;
        }

        /* Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ú†Øª ØªÙ…Ø§Ù…â€ŒØµÙØ­Ù‡ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        .chat-app {
            width: 100%;
            height: 100%; /* ØªÙ…Ø§Ù… ØµÙØ­Ù‡ */
            max-width: 600px; /* Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø¹Ø±Ø¶ Ø¯Ø± Ø¯Ø³Ú©ØªØ§Ù¾ */
            background: rgba(255, 255, 255, 0.02);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        @media (min-height: 700px) and (min-width: 600px) {
            .chat-app {
                height: 95vh;
                border-radius: 30px;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
        }

        header {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.07);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        header h1 { margin: 0; font-size: 18px; color: #00d2ff; }

        .messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: url('https://www.transparenttextures.com/patterns/cubes.png'); /* Ø¨Ø§ÙØª Ù…Ù„Ø§ÛŒÙ… Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ */
        }

        .msg {
            max-width: 85%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.5;
            word-wrap: break-word;
            animation: slideUp 0.3s ease-out forwards;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .sent {
            align-self: flex-end;
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            color: white;
            border-bottom-left-radius: 4px;
        }

        .received {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.12);
            color: #ffffff;
            border-bottom-right-radius: 4px;
        }

        .sender-name {
            display: block;
            font-size: 10px;
            font-weight: 800;
            margin-bottom: 3px;
            color: #00d2ff;
        }
        .sent .sender-name { color: #e0faff; }

        /* Ø¨Ø®Ø´ ÙÙˆØªØ± Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        .footer {
            padding: 12px;
            background: #1a1a25;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: env(safe-area-inset-bottom); /* Ø±Ø¹Ø§ÛŒØª Ø­Ø§Ø´ÛŒÙ‡ Ø¯Ú©Ù…Ù‡ Ù‡ÙˆÙ… Ø¯Ø± Ø¢ÛŒÙÙˆÙ† */
        }

        input[type="text"] {
            flex: 1;
            height: 50px; /* Ø§Ø±ØªÙØ§Ø¹ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ù„Ù…Ø³ÛŒ */
            padding: 0 20px;
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø²ÙˆÙ… Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± iOS */
            outline: none;
        }

        #send-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #00d2ff;
            flex-shrink: 0;
        }

        .hidden { display: none !important; }

        /* Ø§Ø³Ú©Ø±ÙˆÙ„â€ŒØ¨Ø§Ø± Ø²ÛŒØ¨Ø§ */
        .messages::-webkit-scrollbar { width: 4px; }
        .messages::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
    </style>
</head>
<body>

    <div id="login-screen" class="overlay">
        <div class="login-box">
            <h2>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú†Øª</h2>
            <input type="text" id="name-input" placeholder="Ù†Ø§Ù… Ø´Ù…Ø§...">
            <button onclick="initUser()" style="height: 50px; border-radius: 25px;">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¯Ù†ÛŒØ§ÛŒ Ú†Øª</button>
        </div>
    </div>

    <div class="chat-app">
        <header>
            <h1>Ú†Øª Ø¬Ù‡Ø§Ù†ÛŒ ğŸŒ</h1>
            <button onclick="changeName()" style="width: auto; height: 32px; padding: 0 12px; font-size: 11px; background: #ff4757; border-radius: 10px;">Ø®Ø±ÙˆØ¬</button>
        </header>

        <div id="chat-messages" class="messages"></div>

        <div class="footer">
            <input type="text" id="message-input" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." onkeypress="handleEnter(event)">
            <button id="send-btn" onclick="sendMsg()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDTZ68yTUyrpoKJdVRQzY7ZJ2mUUrWv-PM",
            databaseURL: "https://my-online-game-91998-default-rtdb.europe-west1.firebasedatabase.app/"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        let username = localStorage.getItem('chat_name');

        if (username) {
            document.getElementById('login-screen').classList.add('hidden');
            listenForMessages();
        }

        function initUser() {
            const input = document.getElementById('name-input').value.trim();
            if (input.length < 2) return alert("Ù†Ø§Ù… Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª");
            username = input;
            localStorage.setItem('chat_name', username);
            document.getElementById('login-screen').classList.add('hidden');
            listenForMessages();
        }

        function handleEnter(e) { if (e.key === 'Enter') sendMsg(); }

        function sendMsg() {
            const msgInput = document.getElementById('message-input');
            const text = msgInput.value.trim();
            if (text === "") return;

            database.ref('messages').push({
                name: username,
                message: text,
                time: firebase.database.ServerValue.TIMESTAMP
            });
            msgInput.value = "";
            msgInput.focus();
        }

        function listenForMessages() {
            const container = document.getElementById('chat-messages');
            database.ref('messages').limitToLast(40).on('value', (snapshot) => {
                container.innerHTML = "";
                snapshot.forEach((child) => {
                    const data = child.val();
                    const isMe = data.name === username;
                    const msgDiv = document.createElement('div');
                    msgDiv.className = `msg ${isMe ? 'sent' : 'received'}`;
                    msgDiv.innerHTML = `<span class="sender-name">${data.name}</span>${data.message}`;
                    container.appendChild(msgDiv);
                });
                // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¢Ù†ÛŒ Ø¨Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù…
                container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
            });
        }

        function changeName() {
            localStorage.removeItem('chat_name');
            location.reload();
        }
    </script>
</body>
</html>

